<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>ì•”í˜¸í™”í ì˜¬ì¸ì› ê³„ì‚°ê¸° | BitgetÂ·BybitÂ·OKXÂ·MEXCÂ·BinanceÂ·BingX</title>
  <meta name="description" content="ê±°ë˜ì†Œë³„ ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œìœ¨(í˜ì´ë°± ì´ì „) ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ìˆ˜ë£ŒÂ·í˜ì´ë°±, ë ˆë²„ë¦¬ì§€ PNL, í‰ë‹¨ê°€, ê¹€í”„, í™˜ìœ¨ ë³€í™˜ê¹Œì§€ í•œ ë²ˆì— ê³„ì‚°. ëª¨ë°”ì¼ ì™„ì „ ì§€ì›.">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">

  <style>
    :root{
      --bg:#f7f7fb; --fg:#111827; --muted:#374151; --line:#e5e7eb;
      --accent:#2563eb; --accent2:#0ea5e9;
      font-size:17px;
    }
    html{ -webkit-text-size-adjust:100%; }
    @media (min-width:900px){ :root{ font-size:18px; } }
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font-family:"Pretendard",system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
      line-height:1.65
    }
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:1120px;margin:0 auto;padding:24px 24px 32px}
    h1{margin:0 0 8px}
    .lead{margin:0 0 18px;color:var(--muted);font-size:1rem}
    .topbar{display:flex;align-items:center;gap:10px}.spacer{flex:1}
    .theme-toggle{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:700;min-height:44px}
    .theme-toggle svg{width:18px;height:18px}

    .card{background:#fff;border:1px solid var(--line);border-radius:20px;padding:18px 20px;margin-top:16px}
    .section-title{margin:0 0 12px;font-weight:900;font-size:1.125rem}
    @media (min-width:900px){ .section-title{font-size:1.25rem} }
    label{display:block;font-size:0.95rem;margin:8px 0 6px;font-weight:700}
    input,select,button{font-size:1rem}
    input,select{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:14px;background:#fff;min-height:44px}
    .row{display:flex;gap:10px;flex-wrap:wrap}.row>*{flex:1 1 200px}
    .hidden{display:none !important;}

    /* Tabs */
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:16px}
    .tab-btn{padding:12px 16px;border:1px solid var(--line);border-radius:14px;background:#fff;font-weight:800;cursor:pointer;min-height:44px}
    .tab-btn.active{background:#111827;color:#fff}
    .tab-panel{display:none !important;}
    .tab-panel.active{display:block !important;}

    /* Segmented buttons */
    .seg{display:flex;gap:8px}
    .seg button{flex:1;padding:12px;border:1px solid var(--line);background:#fff;border-radius:14px;cursor:pointer;font-weight:800;min-height:44px; pointer-events:auto}
    .seg button.active{background:#111827;color:#fff;border-color:#111827}

    .kv{display:flex;justify-content:space-between;align-items:center;padding:8px 0}
    .kv .k{font-weight:800}.kv .v{font-weight:900;font-variant-numeric:tabular-nums}
    .result-box{border:1px dashed var(--line);border-radius:14px;padding:12px;background:#fafafa}
    .hr{height:1px;background:var(--line);margin:6px 0}

    .cta-main{display:inline-flex;align-items:center;justify-content:center;border:0;border-radius:14px;padding:14px 16px;font-weight:900;color:#fff;text-decoration:none;width:100%;min-height:48px;background:linear-gradient(90deg,#0ea5e9,#6366f1)}
    .trust{font-size:0.95rem;background:#fff7ed;border:1px solid #fde68a;border-radius:14px;padding:10px 12px;margin-top:8px}

    /* Banners */
    .banner{display:flex;gap:12px;align-items:center;color:#fff;border-radius:22px;padding:18px 20px;margin:0 0 12px;border:1px solid rgba(255,255,255,.12);flex-wrap:wrap;box-shadow:0 10px 22px rgba(2,8,20,.06)}
    .banner img{width:48px;height:48px;object-fit:contain;background:rgba(255,255,255,.12);border-radius:12px;padding:6px}
    .banner h3{margin:0;font-size:18px}
    .banner p{margin:4px 0 0;font-size:15px;display:flex;flex-wrap:wrap;gap:6px}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.35);font-weight:800;white-space:nowrap}
    .badge b{font-size:1.05rem;font-weight:900;color:#fff}
    .cta{margin-left:auto;padding:12px 14px;border-radius:14px;background:#fff;color:#000;font-weight:900;text-decoration:none}

    /* Logos */
    .logos{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(min-width:600px){.logos{grid-template-columns:repeat(3,1fr)}}
    @media(min-width:900px){.logos{grid-template-columns:repeat(6,1fr)}}
    .logo{display:flex;flex-direction:column;align-items:center;gap:8px;background:#fff;border:1px solid var(--line);border-radius:18px;padding:14px 10px;text-align:center;text-decoration:none;color:inherit}
    .logo .img{width:56px;height:56px;border-radius:12px;border:1px solid var(--line);background:#f8fafc;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .logo img{width:100%;height:100%;object-fit:contain}

    /* Tip + ë¹„êµí‘œ */
    .tip{background:#eff6ff;border:1px solid #bfdbfe;border-radius:12px;padding:14px 16px;color:#1e3a8a}
    .table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .table th,.table td{padding:12px 14px;border-bottom:1px solid var(--line);text-align:left}
    .table th{background:#f9fafb}
    .table tr:last-child td{border-bottom:0}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:700;font-size:12px;border:1px solid #c7d2fe}

    /* í° ê¸€ì”¨ / ê³ ëŒ€ë¹„ / ë‹¤í¬ */
    body.is-large{ font-size: clamp(18px, 2.25vw, 21px); }
    body.is-large .section-title{ font-size: clamp(1.2rem, 2.2vw, 1.35rem); }
    body.is-contrast{
      --bg:#ffffff; --fg:#0b0f19; --muted:#1f2937; --line:#11182733;
      background:#ffffff; color:var(--fg);
    }
    body.is-contrast .card{ background:#ffffff; border-color:#1f293733; }
    body.is-contrast .tab-btn.active{ background:#0b0f19; color:#fff; border-color:#0b0f19; }
    body.is-dark{color-scheme:dark;--bg:#0b1220;--fg:#e2e8f0;--muted:#cbd5e1;--line:rgba(255,255,255,.1)}
    body.is-dark .card{background:rgba(16,23,42,.75);border-color:rgba(255,255,255,.06)}
    body.is-dark input,body.is-dark select{background:#0f172a;color:#e2e8f0;border-color:rgba(255,255,255,.12)}
    body.is-dark .tab-btn{background:#0f172a;color:#e2e8f0;border-color:rgba(255,255,255,.12)}
    body.is-dark .tab-btn.active{background:#e2e8f0;color:#0b1220;border-color:#e2e8f0}
    body.is-dark .table th{background:#0f172a}

    /* ë°°ë„ˆ/í‘œ ìˆ˜ìˆ˜ë£Œ ê¸€ì”¨ ê°•ì¡° */
    .banner .badge b{ font-size:1.05rem; font-weight:900; color:#fff; }
    body.is-large .banner .badge b{ font-size:1.2rem; }
    .table td:nth-child(2), .table td:nth-child(3){ font-weight:800; font-size:1rem; color:#111827; }
    body.is-large .table td:nth-child(2), body.is-large .table td:nth-child(3){ font-size:1.15rem; }

    /* ===== Mobile-first tidy pack ===== */
    @media (max-width:480px){
      :root{ font-size: 16.5px; }
      .wrap{ padding: 16px 14px 28px; }

      .card{
        border-radius: 16px;
        padding: 14px 14px;
        border: 1px solid rgba(17,24,39,0.08);
        box-shadow: 0 1px 8px rgba(0,0,0,.04);
        background: #fff;
      }

      label{ margin: 6px 0 6px; font-size: 1rem; }
      input, select{ min-height: 48px; padding: 12px 12px; }

      .seg{ gap: 6px; }
      .seg button{
        min-height: 44px;
        border-radius: 12px;
        border-color: rgba(17,24,39,.12);
      }
      .seg button.active{ background:#111827; color:#fff; border-color:#111827; }

      .tabs.mobile-sticky-tabs{
        position: sticky; top: 0; z-index: 20;
        background: var(--bg);
        padding: 8px 0 10px;
        margin: 6px 0 10px;
        overflow-x: auto; white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }
      .tabs.mobile-sticky-tabs .tab-btn{
        flex: 0 0 auto;
        padding: 10px 12px;
        border-radius: 12px;
        min-height: 40px;
      }

      .result-box{
        border: 0; background: #f6f7fb;
        border-radius: 12px; padding: 12px;
      }
      .kv{ padding: 6px 0; }
      .kv .v{ font-size: 1.05rem; font-weight: 900; }

      .banner{
        border-radius: 14px; padding: 12px 12px; gap: 10px;
        background: linear-gradient(0deg, rgba(255,255,255,.08), rgba(255,255,255,.08));
        color: inherit; border: 1px solid rgba(17,24,39,.08);
      }
      .banner img{ width: 36px; height: 36px; background: #fff; border: 1px solid rgba(17,24,39,.08); }
      .banner h3{ font-size: 15px; color: #111827; }
      .banner p{ font-size: 13.5px; gap: 6px; color: #374151; }
      .badge{ padding: 4px 8px; border-radius: 999px; background: #eef2ff; border: 0; color:#3730a3; }
      .badge b{ color:#111827; }
      .banner .cta{
        width: 100%; margin: 4px 0 0; text-align: center;
        border-radius: 12px; padding: 10px 12px;
      }

      .logos{ grid-template-columns: repeat(2, 1fr); gap: 10px; }
      .logo{ border-radius: 12px; padding: 12px 8px; }
      .logo .img{ width: 48px; height: 48px; border-radius: 10px; }

      .table{ border-radius: 10px; }
      .table th, .table td{ padding: 10px 10px; }
      .table td:nth-child(2), .table td:nth-child(3){ font-size: 1.05rem; font-weight: 800; }

      .lead{ color:#4b5563; line-height:1.65; }
      input, select, button{ font-size: 16px; } /* iOS í™•ëŒ€ ë°©ì§€ */

      .row{ gap: 8px; }
      .hr{ margin: 8px 0; }

      .cta-main{ min-height: 48px; font-size: 16px; border-radius: 12px; }
    }

    @media (prefers-reduced-motion: reduce){
      *{ scroll-behavior: auto !important; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <h1 style="margin-right:8px">ì•”í˜¸í™”í ì˜¬ì¸ì› ê³„ì‚°ê¸°</h1>
    <div class="spacer"></div>
    <button id="btnLarge" class="theme-toggle" aria-label="ê¸€ì”¨ í¬ê²Œ" title="ê¸€ì”¨ í¬ê²Œ" aria-pressed="false">ê¸€ì”¨ í¬ê²Œ</button>
    <button id="btnContrast" class="theme-toggle" aria-label="ê³ ëŒ€ë¹„ ëª¨ë“œ" title="ê³ ëŒ€ë¹„ ëª¨ë“œ">ê³ ëŒ€ë¹„</button>
    <button id="themeBtn" class="theme-toggle" aria-label="í…Œë§ˆ ì „í™˜" title="í…Œë§ˆ ì „í™˜">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4a1 1 0 0 1 1-1h0a1 1 0 1 1-2 0h0a1 1 0 0 1 1 1Zm0 17a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm9-9a1 1 0 1 1 0 2 1 1 0 0 1 0-2ZM4 12a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm13.66 6.66a1 1 0 0 1 1.41 1.41 1 1 0 0 1-1.41-1.41ZM4.93 5.64A1 1 0 0 1 3.5 4.22a1 1 0 1 1 1.41 1.42Zm14.14-1.42a1 1 0 0 1-1.41 1.42 1 1 0 1 1 1.41-1.42ZM5.64 19.07a1 1 0 1 1-1.41 1.41 1 1 0 0 1 1.41-1.41ZM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10Z"/></svg>
      <span id="themeLabel">ë¼ì´íŠ¸</span>
    </button>
  </div>

  <p class="lead">ìˆ˜ìˆ˜ë£Œ/í˜ì´ë°±(ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ ë‚©ë¶€ í›„ í™˜ê¸‰), ë ˆë²„ë¦¬ì§€ PNL, í‰ë‹¨ê°€, ê¹€í”„, í™˜ìœ¨ ë³€í™˜ê¹Œì§€ í•œ ë²ˆì—.</p>

  <!-- Tabs (ëª¨ë°”ì¼ ìƒë‹¨ ê³ ì •ìš© í´ë˜ìŠ¤ ì¶”ê°€) -->
  <div class="tabs mobile-sticky-tabs" role="tablist" aria-label="ê³„ì‚°ê¸° íƒ­">
    <button class="tab-btn active" data-tab="fee">ìˆ˜ìˆ˜ë£Œ</button>
    <button class="tab-btn" data-tab="pnl">ìˆ˜ìµë¥ /PNL</button>
    <button class="tab-btn" data-tab="avg">í‰ë‹¨ê°€</button>
    <button class="tab-btn" data-tab="kimchi">ê¹€í”„</button>
    <button class="tab-btn" data-tab="fx">í™˜ìœ¨/ë³€í™˜</button>
  </div>

  <!-- ìˆ˜ìˆ˜ë£Œ ê³„ì‚°ê¸° -->
  <section id="panel-fee" class="tab-panel active" role="tabpanel" aria-labelledby="fee">
    <div class="card">
      <h3 class="section-title">ê¸°ë³¸ ì„¤ì •</h3>
      <div class="row">
        <div>
          <label>ê±°ë˜ì†Œ</label>
          <!-- ê¸°ë³¸ ì˜µì…˜ì„ ë¯¸ë¦¬ ë„£ì–´ ì•ˆì „í•˜ê²Œ ë Œë” -->
          <select id="exchange">
            <option value="Bitget">Bitget</option>
            <option value="Bybit">Bybit</option>
            <option value="OKX">OKX</option>
            <option value="MEXC">MEXC</option>
            <option value="Binance">Binance</option>
            <option value="BingX">BingX</option>
          </select>
        </div>
        <div>
          <label>ë§ˆì¼“</label>
          <div class="seg">
            <button id="btn-spot" type="button">ìŠ¤íŒŸ</button>
            <button id="btn-perp" type="button" class="active">ì„ ë¬¼(í¼í”„)</button>
          </div>
        </div>
        <div>
          <label>ì£¼ë¬¸ ìœ í˜•</label>
          <div class="seg">
            <button id="btn-maker" type="button">ì§€ì •ê°€(Maker)</button>
            <button id="btn-taker" type="button" class="active">ì‹œì¥ê°€(Taker)</button>
          </div>
        </div>
      </div>
      <div id="preset-note" class="lead" style="font-size:0.95rem"></div>

      <div class="row" style="margin-top:8px">
        <div>
          <label>ì²´ê²°ê°€ì¹˜ ì…ë ¥ ë°©ì‹</label>
          <div class="seg">
            <button id="btn-mode-notional" type="button" class="active">ì²´ê²°ê°€ì¹˜ ì§ì ‘</button>
            <button id="btn-mode-margin"   type="button">ì¦ê±°ê¸ˆÃ—ë ˆë²„ë¦¬ì§€</button>
          </div>
        </div>
      </div>

      <!-- ì²´ê²°ê°€ì¹˜ ì§ì ‘ -->
      <div class="row" id="row-notional" style="margin-top:8px">
        <div><label>ì²´ê²°ê°€ì¹˜ (USDT)</label><input id="notional" type="number" min="0" value="10000" placeholder="ì˜ˆ: 10000"/></div>
        <div><label>ì»¤ìŠ¤í…€ ìˆ˜ìˆ˜ë£Œìœ¨ (%)</label><input id="customFee" type="number" step="0.0001" min="0" placeholder="í”„ë¦¬ì…‹ ì‚¬ìš©(ì„ íƒ)"/></div>
        <div><label>ê±°ë˜ íšŸìˆ˜ (í•©ì‚°)</label><input id="trades" type="number" min="1" value="1" placeholder="ì˜ˆ: 1"/></div>
        <div><label>ì‚¬ìš©ì í˜ì´ë°± (%)</label><input id="payback" type="number" step="0.1" min="0" max="100" value="20" placeholder="ì˜ˆ: 20"/></div>
      </div>

      <!-- ì¦ê±°ê¸ˆÃ—ë ˆë²„ë¦¬ì§€ -->
      <div class="row hidden" id="row-margin" style="margin-top:8px">
        <div><label>ì¦ê±°ê¸ˆ (USDT)</label><input id="margin" type="number" min="0" value="500" placeholder="ì˜ˆ: 500"/></div>
        <div><label>ë ˆë²„ë¦¬ì§€ (ë°°)</label><input id="leverage" type="number" min="1" max="200" step="1" value="10" placeholder="ì˜ˆ: 10"/></div>
        <div><label>ê±°ë˜ íšŸìˆ˜ (í•©ì‚°)</label><input id="trades2" type="number" min="1" value="1" placeholder="ì˜ˆ: 1"/></div>
        <div><label>ì‚¬ìš©ì í˜ì´ë°± (%)</label><input id="payback2" type="number" step="0.1" min="0" max="100" value="20" placeholder="ì˜ˆ: 20"/></div>
        <div style="flex-basis:100%">
          <div class="lead" id="derived-note" style="font-size:0.95rem;display:none">ì²´ê²°ê°€ì¹˜(ìë™ ê³„ì‚°): <b id="v-notional-derived">â€”</b></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="section-title">ê²°ê³¼</h3>
      <div class="result-box">
        <div class="kv"><div class="k">ì‚¬ìš© ìˆ˜ìˆ˜ë£Œìœ¨</div><div class="v" id="v-rate">-</div></div>
        <div class="kv"><div class="k">ì´ ìˆ˜ìˆ˜ë£Œ (1íšŒ)</div><div class="v" id="v-fee1">-</div></div>
        <div class="kv"><div class="k">ì´ ìˆ˜ìˆ˜ë£Œ (í•©ì‚°)</div><div class="v" id="v-feeN">-</div></div>
        <div class="hr"></div>
        <div class="kv"><div class="k">ì‚¬ìš©ì í˜ì´ë°±</div><div class="v" id="v-payback">-</div></div>
        <div class="kv"><div class="k">ì‚¬ìš©ì ì‹¤ë¶€ë‹´ ìˆ˜ìˆ˜ë£Œ</div><div class="v" id="v-net">-</div></div>
        <div class="kv"><div class="k">ì²´ê° ìˆ˜ìˆ˜ë£Œìœ¨(í‰ê· )</div><div class="v" id="v-eff">-</div></div>
      </div>
      <a id="cta" class="cta-main" href="#" target="_blank" rel="noopener">í˜œíƒ ì ìš© í›„ ì´ë™</a>

      <div class="trust">
        <b>ì•ˆë‚´</b> Â· ê³„ì‚°ì€ <b>ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ</b>ë¡œ ë¨¼ì € ì‚°ì¶œí•œ ë’¤, ì„¤ì •í•œ í˜ì´ë°± ë¹„ìœ¨ì„ í™˜ê¸‰ í˜•íƒœë¡œ ì°¨ê°í•©ë‹ˆë‹¤.<br>
        â€» <b>í˜ì´ë°± ì ìš© ê±°ë˜ì†ŒëŠ” ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œìœ¨ì„ ë¨¼ì € ë‚©ë¶€</b>í•˜ê³ , ì´í›„ í•´ë‹¹ ë¹„ìœ¨ë§Œí¼ <b>í™˜ê¸‰(ìºì‹œë°±)</b> ë°›ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.
      </div>
    </div>
  </section>

  <!-- PNL -->
  <section id="panel-pnl" class="tab-panel" role="tabpanel" aria-labelledby="pnl">
    <div class="card">
      <h3 class="section-title">ìˆ˜ìµë¥  / PNL (í˜„ë¬¼Â·ì„ ë¬¼)</h3>
      <div class="row">
        <div><label>ëª¨ë“œ</label><div class="seg"><button id="pnl-mode-qty" type="button" class="active">ìˆ˜ëŸ‰ ì§ì ‘</button><button id="pnl-mode-margin" type="button">ì¦ê±°ê¸ˆÃ—ë ˆë²„ë¦¬ì§€</button></div></div>
      </div>

      <div class="row" id="pnl-row-qty" style="margin-top:8px">
        <div><label>ë§¤ìˆ˜ê°€</label><input id="pnl-entry" type="number" min="0" value="100" placeholder="ì˜ˆ: 100"/></div>
        <div><label>ë§¤ë„ê°€</label><input id="pnl-exit" type="number" min="0" value="110" placeholder="ì˜ˆ: 110"/></div>
        <div><label>ìˆ˜ëŸ‰</label><input id="pnl-qty" type="number" min="0" value="1" placeholder="ì˜ˆ: 1"/></div>
      </div>

      <div class="row hidden" id="pnl-row-margin" style="margin-top:8px">
        <div><label>ë§¤ìˆ˜ê°€</label><input id="pnl-entry2" type="number" min="0" value="100"/></div>
        <div><label>ë§¤ë„ê°€</label><input id="pnl-exit2" type="number" min="0" value="110"/></div>
        <div><label>ì¦ê±°ê¸ˆ (USDT)</label><input id="pnl-margin" type="number" min="0" value="500"/></div>
        <div><label>ë ˆë²„ë¦¬ì§€ (ë°°)</label><input id="pnl-lev" type="number" min="1" max="200" step="1" value="10"/></div>
      </div>
    </div>
    <div class="card">
      <h3 class="section-title">PNL ê²°ê³¼</h3>
      <div class="result-box">
        <div class="kv"><div class="k">ì†ìµ (USDT)</div><div class="v" id="pnl-pnl">-</div></div>
        <div class="kv"><div class="k">ìˆ˜ìµë¥ </div><div class="v" id="pnl-roe">-</div></div>
        <div class="kv"><div class="k">ì¶”ì • ì²´ê²°ê°€ì¹˜</div><div class="v" id="pnl-notional">-</div></div>
      </div>
      <div class="lead" style="font-size:12px;margin-top:6px">â€» ìˆ˜ìˆ˜ë£Œ/í€ë”©/ìŠ¬ë¦¬í”¼ì§€ëŠ” ë¯¸í¬í•¨. ì„ ë¬¼ ëª¨ë“œì—ì„œ ìˆ˜ëŸ‰ì€ <b>ì¦ê±°ê¸ˆÃ—ë ˆë²„ë¦¬ì§€/ë§¤ìˆ˜ê°€</b>ë¡œ ê°€ì •í•©ë‹ˆë‹¤.</div>
    </div>
  </section>

  <!-- í‰ë‹¨ -->
  <section id="panel-avg" class="tab-panel" role="tabpanel" aria-labelledby="avg">
    <div class="card"><h3 class="section-title">í‰ê·  ë§¤ì…ë‹¨ê°€ ê³„ì‚°</h3>
      <div class="row">
        <div><label>ë§¤ìˆ˜ê°€ A</label><input id="avg-a-price" type="number" min="0" value="100" placeholder="ì˜ˆ: 100"/></div>
        <div><label>ìˆ˜ëŸ‰ A</label><input id="avg-a-qty" type="number" min="0" value="1" placeholder="ì˜ˆ: 1"/></div>
      </div>
      <div class="row">
        <div><label>ë§¤ìˆ˜ê°€ B</label><input id="avg-b-price" type="number" min="0" value="120" placeholder="ì˜ˆ: 120"/></div>
        <div><label>ìˆ˜ëŸ‰ B</label><input id="avg-b-qty" type="number" min="0" value="1" placeholder="ì˜ˆ: 1"/></div>
      </div>
      <div class="row">
        <div><label>ë§¤ìˆ˜ê°€ C (ì„ íƒ)</label><input id="avg-c-price" type="number" min="0" placeholder="ì„ íƒ"/></div>
        <div><label>ìˆ˜ëŸ‰ C (ì„ íƒ)</label><input id="avg-c-qty" type="number" min="0" placeholder="ì„ íƒ"/></div>
      </div>
    </div>
    <div class="card"><h3 class="section-title">í‰ë‹¨ê°€ ê²°ê³¼</h3>
      <div class="result-box">
        <div class="kv"><div class="k">í‰ë‹¨ê°€</div><div class="v" id="avg-price">-</div></div>
        <div class="kv"><div class="k">ì´ ìˆ˜ëŸ‰</div><div class="v" id="avg-qty">-</div></div>
        <div class="kv"><div class="k">ì´ ë§¤ì…ê¸ˆì•¡</div><div class="v" id="avg-sum">-</div></div>
      </div>
    </div>
  </section>

  <!-- ê¹€í”„ -->
  <section id="panel-kimchi" class="tab-panel" role="tabpanel" aria-labelledby="kimchi">
    <div class="card">
      <h3 class="section-title">ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„ ê³„ì‚°
        <button id="help-kimchi" type="button" class="theme-toggle" style="margin-left:8px;padding:4px 10px;min-height:auto">?</button>
      </h3>
      <div class="row">
        <div><label>í•´ì™¸ USDT ê°€ê²©</label><input id="kimchi-usd" type="number" min="0" value="100000" placeholder="ì˜ˆ: 100000"/></div>
        <div><label>êµ­ë‚´ KRW ê°€ê²©</label><input id="kimchi-krw" type="number" min="0" value="138000000" placeholder="ì˜ˆ: 138000000"/></div>
        <div><label>í™˜ìœ¨ (KRW/USD)</label><input id="kimchi-fx" type="number" min="0" value="1380" placeholder="ì˜ˆ: 1380"/></div>
      </div>
    </div>
    <div class="card">
      <h3 class="section-title">ê¹€í”„ ê²°ê³¼</h3>
      <div class="result-box">
        <div class="kv"><div class="k">ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„</div><div class="v" id="kimchi-prem">-</div></div>
        <div class="kv"><div class="k">í•´ì™¸ê°€(ì›í™” í™˜ì‚°)</div><div class="v" id="kimchi-over-krw">-</div></div>
        <div class="kv"><div class="k">êµ­ë‚´-í•´ì™¸(ì›í™”)</div><div class="v" id="kimchi-diff">-</div></div>
      </div>
      <div class="lead" style="font-size:12px;margin-top:6px">â€» í•´ì™¸(USDT)Â·êµ­ë‚´(ì›)Â·í™˜ìœ¨ì„ ë„£ìœ¼ë©´, <b>ê¹€í”„(%) = (êµ­ë‚´ Ã· (í•´ì™¸Ã—í™˜ìœ¨) âˆ’ 1) Ã— 100</b> ìœ¼ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</div>
      <div id="help-kimchi-panel" class="hidden" style="font-size:13px;margin-top:8px">
        ì˜ˆì‹œ) í•´ì™¸ 100,000 Â· í™˜ìœ¨ 1,380 Â· êµ­ë‚´ 138,000,000 â†’ í•´ì™¸í™˜ì‚° 138,000,000ì›, ê¹€í”„ 0%, ì°¨ì•¡ 0ì›
      </div>
    </div>
  </section>

  <!-- í™˜ìœ¨ -->
  <section id="panel-fx" class="tab-panel" role="tabpanel" aria-labelledby="fx">
    <div class="card">
      <h3 class="section-title">í™˜ìœ¨/ë‹¨ìˆœ ë³€í™˜
        <button id="help-fx" type="button" class="theme-toggle" style="margin-left:8px;padding:4px 10px;min-height:auto">?</button>
      </h3>
      <div class="row">
        <div><label>USD â†’ KRW (í™˜ìœ¨ KRW/USD)</label><input id="fx-rate" type="number" min="0" value="1380" placeholder="ì˜ˆ: 1380"/></div>
        <div><label>USD ê¸ˆì•¡</label><input id="fx-usd" type="number" min="0" value="100" placeholder="ì˜ˆ: 100"/></div>
        <div><label>KRW ê¸ˆì•¡</label><input id="fx-krw" type="number" min="0" value="138000" placeholder="ì˜ˆ: 138000"/></div>
      </div>
      <div class="lead" style="font-size:12px;margin-top:6px">â€» USDë¥¼ ë°”ê¾¸ë©´ KRWê°€ ìë™ í™˜ì‚°, KRWë¥¼ ë°”ê¾¸ë©´ USDê°€ ìë™ í™˜ì‚°ë©ë‹ˆë‹¤. (í™˜ìœ¨ = KRW/USD)</div>
      <div id="help-fx-panel" class="hidden" style="font-size:13px;margin-top:8px">
        ì˜ˆì‹œ) í™˜ìœ¨ 1380ì¼ ë•Œ USD 100 â†’ KRW 138,000 / KRW 69,000 â†’ USD 50
      </div>
    </div>
  </section>

  <!-- â–¼ ê±°ë˜ì†Œ ë°°ë„ˆ + ë¡œê³  â–¼ -->
  <div id="exchanges" class="card">
    <div id="banners"></div>
    <div style="margin-top:18px">
      <h3 class="section-title">ê±°ë˜ì†Œ ë°”ë¡œê°€ê¸°</h3>
      <div class="logos" id="logos"></div>
    </div>
  </div>

  <!-- ë¹„êµí‘œ -->
  <div class="card">
    <h3 class="section-title">ê±°ë˜ì†Œ ìˆ˜ìˆ˜ë£Œ ë¹„êµ Â· í•µì‹¬ ìš”ì•½</h3>
    <p class="lead" style="margin:6px 0 12px">ì•„ë˜ëŠ” ì˜ˆì‹œ ê¸°ì¤€(í˜œíƒ ì ìš© í›„) ìš”ì•½ì…ë‹ˆë‹¤. ì‹¤ì œ ì ìš©ì€ ë“±ê¸‰/ì´ë²¤íŠ¸ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    <div style="overflow:auto">
      <table class="table">
        <thead>
          <tr><th>ê±°ë˜ì†Œ</th><th>ì§€ì •ê°€</th><th>ì‹œì¥ê°€</th><th>í˜ì´ë°±</th><th>íŠ¹ì§•</th></tr>
        </thead>
        <tbody id="cmp-body"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
/* ========= ë°ì´í„° ========= */
const PROMOS = [
  { name:'Bitget',  logo:'https://logo.clearbit.com/bitget.com',  grad:['#22d3ee','#2563eb'],
    before:{maker:0.02,taker:0.04}, after:{maker:0.016,taker:0.032},
    payback:'20%', note:'í˜ì´ë°± 20% (ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ ë‚©ë¶€ í›„ í™˜ê¸‰)', link:'https://partner.bitget.com/bg/Jihoon7',
    cta:'ğŸ ì§€ê¸ˆ ê°€ì…í•˜ê³  ìˆ˜ìˆ˜ë£Œ 50%â†“ + í˜ì´ë°± 20% ë°›ê¸°' },
  { name:'Bybit',   logo:'https://logo.clearbit.com/bybit.com',  grad:['#f59e0b','#d97706'],
    before:{maker:0.02,taker:0.055}, after:{maker:0.016,taker:0.049},
    payback:'20%', note:'í˜ì´ë°± 20% (ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ ë‚©ë¶€ í›„ í™˜ê¸‰)', link:'https://partner.bybit.com/b/JIHOON',
    cta:'ğŸš€ Bybit ì‹ ê·œ í˜œíƒ ë°›ê³  ê±°ë˜ ì‹œì‘' },
  { name:'OKX',     logo:'https://logo.clearbit.com/okx.com',    grad:['#111111','#000000'],
    before:{maker:0.02,taker:0.05},  after:{maker:0.016,taker:0.05},
    payback:'20%', note:'í˜ì´ë°± 20% (ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ ë‚©ë¶€ í›„ í™˜ê¸‰)', link:'https://www.okx.com/join/KANGJIHOON',
    cta:'âœ… OKX í˜œíƒ ì ìš© í›„ ë°”ë¡œ ì´ë™' },
  { name:'MEXC',    logo:'https://logo.clearbit.com/mexc.com',   grad:['#10b981','#059669'],
    before:{maker:0.0,taker:0.02},   after:{maker:0.0,taker:0.02},
    payback:'20%', note:'í˜ì´ë°± 20% (ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ ë‚©ë¶€ í›„ í™˜ê¸‰)', link:'https://www.mexc.com/ko-KR/acquisition/custom-sign-up?shareCode=mexc-Jihoon',
    cta:'ğŸ¯ MEXC í˜œíƒ ë°›ê³  ì‹œì‘' },
  { name:'Binance', logo:'https://logo.clearbit.com/binance.com',grad:['#f59e0b','#f59e0b'],
    before:{maker:0.02,taker:0.04},  after:{maker:0.02,taker:0.04},
    payback:'â€”',   note:'ìˆ˜ìˆ˜ë£Œ í• ì¸ 10%', link:'https://accounts.binance.com/register?ref=ME5CYRHB',
    cta:'ğŸ’¡ Binance ìˆ˜ìˆ˜ë£Œ í• ì¸ ì ìš© í›„ ì´ë™' },
  { name:'BingX',   logo:'https://logo.clearbit.com/bingx.com',  grad:['#0ea5e9','#1d4ed8'],
    before:{maker:0.02,taker:0.05},  after:{maker:0.02,taker:0.05},
    payback:'42~45%', note:'í˜ì´ë°± 42~45% (ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ ë‚©ë¶€ í›„ í™˜ê¸‰)', link:'https://bingx.com/invite/2N30XH/',
    cta:'ğŸ”¥ BingX ìµœëŒ€ 45% í˜ì´ë°± ë°›ê³  ì‹œì‘' },
];

const PRESETS = {
  "Bitget": { spot:{ maker:0.0002,  taker:0.0004,  note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ìŠ¤íŒŸ: ì§€ì •ê°€ 0.02% / ì‹œì¥ê°€ 0.04%" },
              perp:{ maker:0.0002,  taker:0.0004,  note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ì„ ë¬¼: ì§€ì •ê°€ 0.02% / ì‹œì¥ê°€ 0.04%" } },
  "Bybit":  { spot:{ maker:0.00016, taker:0.00049, note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ìŠ¤íŒŸ: ì§€ì •ê°€ 0.016% / ì‹œì¥ê°€ 0.049%" },
              perp:{ maker:0.00016, taker:0.00049, note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ì„ ë¬¼: ì§€ì •ê°€ 0.016% / ì‹œì¥ê°€ 0.049%" } },
  "OKX":    { spot:{ maker:0.00016, taker:0.00050, note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ìŠ¤íŒŸ: ì§€ì •ê°€ 0.016% / ì‹œì¥ê°€ 0.05%" },
              perp:{ maker:0.00016, taker:0.00050, note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ì„ ë¬¼: ì§€ì •ê°€ 0.016% / ì‹œì¥ê°€ 0.05%" } },
  "MEXC":   { spot:{ maker:0.0,     taker:0.00020, note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ìŠ¤íŒŸ: ì§€ì •ê°€ 0% / ì‹œì¥ê°€ 0.02%" },
              perp:{ maker:0.0,     taker:0.00020, note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ì„ ë¬¼: ì§€ì •ê°€ 0% / ì‹œì¥ê°€ 0.02%" } },
  "Binance":{ spot:{ maker:0.00020, taker:0.00040, note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ìŠ¤íŒŸ: ì§€ì •ê°€ 0.02% / ì‹œì¥ê°€ 0.04%" },
              perp:{ maker:0.00020, taker:0.00040, note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ì„ ë¬¼: ì§€ì •ê°€ 0.02% / ì‹œì¥ê°€ 0.04%" } },
  "BingX":  { spot:{ maker:0.00020, taker:0.00050, note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ìŠ¤íŒŸ: ì§€ì •ê°€ 0.02% / ì‹œì¥ê°€ 0.05%" },
              perp:{ maker:0.00020, taker:0.00050, note:"ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ Â· ì„ ë¬¼: ì§€ì •ê°€ 0.02% / ì‹œì¥ê°€ 0.05%" } }
};

/* ========= ìœ í‹¸ ========= */
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
const nf=x=>(Math.round((+x||0)*1e8)/1e8).toLocaleString();
const toPerc=x=>((+x||0)*100).toFixed(6).replace(/0+$/,'').replace(/\.$/,'')+'%';

/* ì¦‰ì‹œ ë°˜ì˜(ì• ë‹ˆë©”ì´ì…˜ ì œê±°) */
const animateNumber = (el, target, fmt = (x)=>x) => {
  if (!el) return;
  el.textContent = fmt(target);
  el.dataset.v = target;
};

const toggle=(on,off)=>{ on?.classList.add('active'); off?.classList.remove('active'); };

/* CTAë¥¼ ê±°ë˜ì†Œ ê·¸ë¼ë””ì–¸íŠ¸ë¡œ ë™ê¸°í™” */
function applyExchangeTheme(name){
  const promo = PROMOS.find(p=>p.name === name);
  const btn = document.getElementById('cta');
  if(!promo || !btn) return;
  btn.style.background = `linear-gradient(90deg, ${promo.grad[0]}, ${promo.grad[1]})`;
  btn.style.border = '0';
  btn.style.color = '#fff';
  btn.style.boxShadow = '0 6px 16px rgba(0,0,0,.12)';
}

/* ========= íƒ­ ========= */
$$('.tab-btn').forEach(btn=>{
  btn.setAttribute('role','tab');
  btn.setAttribute('aria-selected', btn.classList.contains('active') ? 'true' : 'false');
  btn.addEventListener('click',()=>{
    const id=btn.dataset.tab;
    $$('.tab-btn').forEach(b=>{b.classList.remove('active'); b.setAttribute('aria-selected','false');});
    btn.classList.add('active'); btn.setAttribute('aria-selected','true');
    $$('.tab-panel').forEach(p=>p.classList.remove('active'));
    $('#panel-'+id).classList.add('active');
  });
});

/* ========= í…Œë§ˆ/ê°€ë…ì„± í† ê¸€ ========= */
const themeBtn=$('#themeBtn'), themeLabel=$('#themeLabel');
const savedTheme=localStorage.getItem('calc-theme');
if(savedTheme==='dark') document.body.classList.add('is-dark');
themeLabel.textContent=document.body.classList.contains('is-dark')?'ë‹¤í¬':'ë¼ì´íŠ¸';
themeBtn?.addEventListener('click',()=>{
  document.body.classList.toggle('is-dark');
  const dark=document.body.classList.contains('is-dark');
  themeLabel.textContent=dark?'ë‹¤í¬':'ë¼ì´íŠ¸';
  localStorage.setItem('calc-theme',dark?'dark':'light');
});

const btnLarge = $('#btnLarge');
const btnContrast = $('#btnContrast');

function syncLargeLabel(){
  const on = document.body.classList.contains('is-large');
  btnLarge.textContent = on ? 'ê¸€ì”¨ ê¸°ë³¸' : 'ê¸€ì”¨ í¬ê²Œ';
  btnLarge.setAttribute('aria-label', on ? 'ê¸€ì”¨ ê¸°ë³¸' : 'ê¸€ì”¨ í¬ê²Œ');
  btnLarge.setAttribute('title', on ? 'ê¸€ì”¨ ê¸°ë³¸' : 'ê¸€ì”¨ í¬ê²Œ');
  btnLarge.setAttribute('aria-pressed', on ? 'true' : 'false');
}
if(localStorage.getItem('is-large')==='1') document.body.classList.add('is-large');
if(localStorage.getItem('is-contrast')==='1') document.body.classList.add('is-contrast');
syncLargeLabel();

btnLarge?.addEventListener('click', ()=>{
  document.body.classList.toggle('is-large');
  localStorage.setItem('is-large', document.body.classList.contains('is-large')?'1':'0');
  syncLargeLabel();
});
btnContrast?.addEventListener('click', ()=>{
  document.body.classList.toggle('is-contrast');
  localStorage.setItem('is-contrast', document.body.classList.contains('is-contrast')?'1':'0');
});

/* ========= ìˆ˜ìˆ˜ë£Œ ê³„ì‚°ê¸° ========= */
let state={exchange:'Bitget',market:'perp',order:'taker',mode:'notional'};

const elExchange=$('#exchange');
const elSpot=$('#btn-spot'), elPerp=$('#btn-perp');
const elMaker=$('#btn-maker'), elTaker=$('#btn-taker');
const rowNotional=$('#row-notional'), rowMargin=$('#row-margin');
const elNotional=$('#notional'), elCustom=$('#customFee'), elTrades=$('#trades'), elPayback=$('#payback');
const elMargin=$('#margin'), elLev=$('#leverage'), elTrades2=$('#trades2'), elPayback2=$('#payback2');
const vDerived=$('#v-notional-derived');
const elNote=$('#preset-note'), vRate=$('#v-rate'), vFee1=$('#v-fee1'), vFeeN=$('#v-feeN'), vPB=$('#v-payback'), vNet=$('#v-net'), vEff=$('#v-eff'), elCTA=$('#cta');

/* ì•ˆì „ ê°€ë“œ: ì…€ë ‰íŠ¸ê°€ ë¹„ì–´ ìˆì„ ë•Œë§Œ PRESETSë¡œ ì±„ì›€ */
(function ensureExchangeOptions(){
  try{
    if (!elExchange) return;
    if (elExchange.options.length === 0) {
      Object.keys(PRESETS).forEach(n=>{
        const o = document.createElement('option');
        o.value = n; o.textContent = n;
        elExchange.appendChild(o);
      });
    }
    const hasCurrent = [...elExchange.options].some(opt=>opt.value === state.exchange);
    state.exchange = hasCurrent ? state.exchange : (elExchange.options[0]?.value || 'Bitget');
    elExchange.value = state.exchange;
  }catch(e){
    console.error('ensureExchangeOptions error', e);
  }
})();

function setFeeMode(mode){
  if(mode==='notional'){
    $('#btn-mode-notional').classList.add('active');
    $('#btn-mode-margin').classList.remove('active');
    rowNotional.classList.remove('hidden'); rowMargin.classList.add('hidden');
    state.mode='notional';
  }else{
    $('#btn-mode-margin').classList.add('active');
    $('#btn-mode-notional').classList.remove('active');
    rowMargin.classList.remove('hidden'); rowNotional.classList.add('hidden');
    state.mode='margin';
  }
  updateFee();
}
document.addEventListener('click',(e)=>{
  const t=e.target.closest('button');
  if(!t) return;
  if(t.id==='btn-mode-notional'){ e.preventDefault(); setFeeMode('notional'); }
  if(t.id==='btn-mode-margin'){   e.preventDefault(); setFeeMode('margin'); }
});

function updateFee(){
  try{
    const ex=state.exchange, mk=state.market, od=state.order;
    const presetRate = (PRESETS && PRESETS[ex] && PRESETS[ex][mk] && PRESETS[ex][mk][od]) || 0;
    const note = (PRESETS && PRESETS[ex] && PRESETS[ex][mk] && PRESETS[ex][mk].note) || '';
    const custom=parseFloat(elCustom.value||'');
    const rate=isNaN(custom)?presetRate:custom/100;

    let N=0, t=1, pbRate=0;
    if(state.mode==='notional'){
      N=Math.max(0,parseFloat(elNotional.value||'0'));
      t=Math.max(1,parseInt(elTrades.value||'1',10));
      pbRate=Math.max(0,Math.min(1,(parseFloat(elPayback.value)||0)/100));
      $('#derived-note').style.display='none';
    }else{
      const m=Math.max(0,parseFloat(elMargin.value||'0'));
      const lv=Math.max(1,parseFloat(elLev.value||'1'));
      N=m*lv;
      vDerived.textContent=nf(N)+' USDT';
      $('#derived-note').style.display='block';
      t=Math.max(1,parseInt(elTrades2.value||'1',10));
      pbRate=Math.max(0,Math.min(1,(parseFloat(elPayback2.value)||0)/100));
    }

    const fee1=N*rate, feeN=fee1*t;
    const pb=feeN*pbRate, net=feeN-pb, eff=N>0?net/(N*t):0;

    elNote.textContent=`í”„ë¦¬ì…‹: ${ex} / ${mk==='spot'?'ìŠ¤íŒŸ':'ì„ ë¬¼'} / ${od.toUpperCase()} = ${toPerc(presetRate)} Â· ${note}`;
    animateNumber(vRate, rate, toPerc);
    animateNumber(vFee1, fee1, x=>nf(x)+' USDT');
    animateNumber(vFeeN, feeN, x=>nf(x)+' USDT');
    animateNumber(vPB, pb,   x=>nf(x)+' USDT');
    animateNumber(vNet, net, x=>nf(x)+' USDT');
    animateNumber(vEff, eff, toPerc);

    const promo=PROMOS.find(p=>p.name===ex);
    if(promo){ elCTA.href = promo.link; elCTA.textContent = promo.cta; }
    applyExchangeTheme(ex); // ê±°ë˜ì†Œë³„ CTA ìƒ‰ ì ìš©
  }catch(e){ console.error('updateFee error', e); }
}

elExchange.addEventListener('change',()=>{state.exchange=elExchange.value;updateFee()});
elSpot.addEventListener('click',()=>{state.market='spot';toggle(elSpot,elPerp);updateFee()});
elPerp.addEventListener('click',()=>{state.market='perp';toggle(elPerp,elSpot);updateFee()});
elMaker.addEventListener('click',()=>{state.order='maker';toggle(elMaker,elTaker);updateFee()});
elTaker.addEventListener('click',()=>{state.order='taker';toggle(elTaker,elMaker);updateFee()});
[elNotional,elCustom,elTrades,elPayback,elMargin,elLev,elTrades2,elPayback2].forEach(el=>el.addEventListener('input',updateFee));

/* ========= PNL ========= */
const pnlQty=$('#pnl-row-qty'), pnlMargin=$('#pnl-row-margin');
const btnQty=$('#pnl-mode-qty'), btnMargin=$('#pnl-mode-margin');
const pnl_el={pnl:$('#pnl-pnl'),roe:$('#pnl-roe'),notional:$('#pnl-notional')};

function setPnlMode(m){
  if(m==='qty'){ btnQty.classList.add('active'); btnMargin.classList.remove('active'); pnlQty.classList.remove('hidden'); pnlMargin.classList.add('hidden'); }
  else{ btnMargin.classList.add('active'); btnQty.classList.remove('active'); pnlMargin.classList.remove('hidden'); pnlQty.classList.add('hidden'); }
  calcPNL();
}
btnQty.addEventListener('click',()=>setPnlMode('qty'));
btnMargin.addEventListener('click',()=>setPnlMode('margin'));
['pnl-entry','pnl-exit','pnl-qty','pnl-entry2','pnl-exit2','pnl-margin','pnl-lev'].forEach(id=>document.getElementById(id).addEventListener('input',calcPNL));

function calcPNL(){
  if(pnlMargin.classList.contains('hidden')){
    const entry=+($('#pnl-entry').value||0), exit=+($('#pnl-exit').value||0), qty=+($('#pnl-qty').value||0);
    const pnl=(exit-entry)*qty; const notional=entry*qty; const roe=notional>0?pnl/notional:0;
    animateNumber(pnl_el.pnl,pnl,x=>nf(x)+' USDT'); animateNumber(pnl_el.roe,roe,toPerc); animateNumber(pnl_el.notional,notional,x=>nf(x)+' USDT'); return;
  }
  const entry=+($('#pnl-entry2').value||0), exit=+($('#pnl-exit2').value||0), m=+($('#pnl-margin').value||0), lv=Math.max(1,+($('#pnl-lev').value||1));
  const notional=entry>0?m*lv:0; const qty=entry>0?(m*lv)/entry:0; const pnl=(exit-entry)*qty; const roe=m>0?pnl/m:0;
  animateNumber(pnl_el.pnl,pnl,x=>nf(x)+' USDT'); animateNumber(pnl_el.roe,roe,toPerc); animateNumber(pnl_el.notional,notional,x=>nf(x)+' USDT');
}

/* ========= í‰ë‹¨ ========= */
['avg-a-price','avg-a-qty','avg-b-price','avg-b-qty','avg-c-price','avg-c-qty'].forEach(id=>document.getElementById(id).addEventListener('input',calcAVG));
function calcAVG(){
  const pA=+($('#avg-a-price').value||0), qA=+($('#avg-a-qty').value||0);
  const pB=+($('#avg-b-price').value||0), qB=+($('#avg-b-qty').value||0);
  const pC=+($('#avg-c-price').value||0), qC=+($('#avg-c-qty').value||0);
  const sum=pA*qA + pB*qB + (pC*qC||0);
  const qty=qA + qB + (qC||0);
  const avg=qty>0?sum/qty:0;
  animateNumber($('#avg-price'),avg,nf);
  animateNumber($('#avg-qty'),qty,nf);
  animateNumber($('#avg-sum'),sum,nf);
}

/* ========= ê¹€í”„ ========= */
['kimchi-usd','kimchi-krw','kimchi-fx'].forEach(id=>document.getElementById(id).addEventListener('input',calcKimchi));
function calcKimchi(){
  const usd=+($('#kimchi-usd').value||0), krw=+($('#kimchi-krw').value||0), fx=+($('#kimchi-fx').value||0);
  const overKRW=usd*fx;
  const prem=overKRW>0?(krw/overKRW-1):0;
  const diff=krw-overKRW;
  animateNumber($('#kimchi-prem'),prem,toPerc);
  animateNumber($('#kimchi-over-krw'),overKRW,x=>nf(x)+' ì›');
  animateNumber($('#kimchi-diff'),diff,x=>nf(x)+' ì›');
}

/* ========= í™˜ìœ¨ ========= */
['fx-rate','fx-usd','fx-krw'].forEach(id=>document.getElementById(id).addEventListener('input',calcFX));
let fxLock=false;
function calcFX(e){
  if(fxLock) return; fxLock=true;
  const rate=+($('#fx-rate').value||0);
  const usdEl=$('#fx-usd'), krwEl=$('#fx-krw');
  if(e && e.target===usdEl){
    const krw=rate*(+usdEl.value||0); krwEl.value=(isFinite(krw)?Math.round(krw*100)/100:0);
  }else if(e && e.target===krwEl){
    const usd=rate>0?(+krwEl.value||0)/rate:0; usdEl.value=(isFinite(usd)?Math.round(usd*1000000)/1000000:0);
  }else{
    const usd=+usdEl.value||0; krwEl.value=(isFinite(rate*usd)?Math.round(rate*usd*100)/100:0);
  }
  fxLock=false;
}

/* ========= ë„ì›€ë§ í† ê¸€ ========= */
$('#help-kimchi')?.addEventListener('click',(e)=>{
  const p=$('#help-kimchi-panel'); const isOpen=p.classList.toggle('hidden')===false;
  e.currentTarget.setAttribute('aria-expanded', isOpen ? 'true':'false');
});
$('#help-fx')?.addEventListener('click',(e)=>{
  const p=$('#help-fx-panel'); const isOpen=p.classList.toggle('hidden')===false;
  e.currentTarget.setAttribute('aria-expanded', isOpen ? 'true':'false');
});

/* ========= ë°°ë„ˆ/ë¡œê³ /ë¹„êµí‘œ ========= */
function renderExchanges(){
  const banners=$('#banners'); const logos=$('#logos'); const body=$('#cmp-body');
  PROMOS.forEach(p=>{
    const el=document.createElement('div');
    el.className='banner';
    el.style.background=`linear-gradient(90deg,${p.grad[0]},${p.grad[1]})`;
    el.innerHTML=`
      <img src="${p.logo}" alt="${p.name}">
      <div style="flex:1;min-width:200px">
        <h3>${p.name} ìˆ˜ìˆ˜ë£Œ ì•ˆë‚´</h3>
        <p>
          <span class="badge">ì ìš© ì „: ì§€ì •ê°€ <b>${p.before.maker}%</b> / ì‹œì¥ê°€ <b>${p.before.taker}%</b></span>
          <span class="badge">ì ìš© í›„: ì§€ì •ê°€ <b>${p.after.maker}%</b> / ì‹œì¥ê°€ <b>${p.after.taker}%</b></span>
          <span class="badge">${p.note}</span>
        </p>
      </div>
      <a class="cta" href="${p.link}" target="_blank" rel="noopener">${p.cta}</a>`;
    banners.appendChild(el);

    const a=document.createElement('a'); a.className='logo'; a.href=p.link; a.target='_blank'; a.rel='noopener';
    a.innerHTML=`<div class="img"><img src="${p.logo}" onerror="this.style.display='none';this.parentElement.innerHTML='<span style=\\'font-weight:700;font-size:13px\\'>${p.name}</span>';"></div>
      <div style="font-weight:900">${p.name}</div>
      <div style="font-size:12px;color:#2563eb;font-weight:800">í˜œíƒ í˜ì´ì§€ ì´ë™</div>`;
    logos.appendChild(a);

    const tr=document.createElement('tr');
    tr.innerHTML=`<td style="font-weight:800">${p.name}</td>
      <td>${p.after.maker}%</td><td>${p.after.taker}%</td>
      <td><span class="pill">${p.payback}</span></td><td>${p.note}</td>`;
    body.appendChild(tr);
  });
}

/* ========= ì´ˆê¸° ì‹¤í–‰ ========= */
(function boot(){
  setFeeMode('notional');
  updateFee(); calcPNL(); calcAVG(); calcKimchi(); calcFX();
  renderExchanges();
  applyExchangeTheme(state.exchange); // ì´ˆê¸° CTA ìƒ‰ìƒ ì ìš©
})();
</script>
</body>
</html>
