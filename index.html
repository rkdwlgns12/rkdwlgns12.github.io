<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>코인 수수료 계산기 | Bitget·Bybit·OKX·MEXC·Binance·BingX</title>
  <meta name="description" content="거래소별 지정가/시장가 수수료와 페이백을 한번에 계산. 혜택 적용 CTA와 비교표, FAQ까지 제공. 모바일 완전 지원.">
  <link rel="canonical" href="https://rkdwlgns12.github.io/coinfeecalc7/" />

  <!-- OG / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="코인 수수료 계산기">
  <meta property="og:title" content="코인 수수료 계산기">
  <meta property="og:description" content="거래소별 수수료/페이백 계산, 혜택 적용 CTA, 비교/FAQ 제공">
  <meta property="og:url" content="https://rkdwlgns12.github.io/coinfeecalc7/">
  <meta property="og:image" content="https://rkdwlgns12.github.io/coinfeecalc7/og-cover.png">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Premium font -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">

  <style>
    :root{
      --bg:#f7f7fb; --fg:#111827; --muted:#6b7280; --line:#e5e7eb; --radius:16px;
      --accent:#2563eb; --accent2:#0ea5e9; --ok:#059669; --warn:#f59e0b; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto}
    a{color:#2563eb;text-decoration:none}
    .wrap{max-width:1120px;margin:0 auto;padding:24px 24px 32px}
    h1{margin:0 0 8px}
    .lead{margin:0 0 18px;color:var(--muted)}
    .topbar{display:flex;align-items:center;gap:10px}
    .spacer{flex:1}

    /* theme toggle */
    .theme-toggle{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:12px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:700}
    .theme-toggle svg{width:18px;height:18px}

    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:2fr 1fr}}

    .card{background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:16px 18px}
    .section-title{margin:0 0 12px;font-weight:800}

    label{display:block;font-size:13px;color:#374151;margin:8px 0 6px}
    input,select,button{font-size:14px}
    input,select{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff}
    .row{display:flex;gap:8px;flex-wrap:wrap}.row>*{flex:1 1 200px}

    .seg{display:flex;gap:8px}
    .seg button{flex:1;padding:10px 12px;border:1px solid var(--line);background:#fff;border-radius:12px;cursor:pointer}
    .seg button.active{background:#111827;color:#fff;border-color:#111827}

    .kv{display:flex;justify-content:space-between;align-items:center;padding:6px 0}
    .kv .k{color:#374151;font-weight:600;display:flex;align-items:center;gap:6px}
    .kv .v{font-weight:900}

    .result-box{border:1px dashed var(--line);border-radius:12px;padding:10px 12px;background:#fafafa}
    .hr{height:1px;background:var(--line);margin:6px 0}

    .cta-main{display:inline-flex;align-items:center;justify-content:center;border:0;border-radius:12px;padding:12px 14px;font-weight:900;color:#fff;text-decoration:none;width:100%}
    .trust{font-size:12px;color:#374151;background:#fff7ed;border:1px solid #fde68a;border-radius:12px;padding:10px 12px;margin-top:8px}
    .trust b{color:#b45309}

    /* 배너(그라디언트) */
    .banner{display:flex;gap:12px;align-items:center;color:#fff;border-radius:16px;padding:14px 16px;margin:0 0 12px;border:1px solid rgba(255,255,255,.12);transform:translateZ(0);will-change:transform;transition:transform 120ms ease}
    .banner img{width:48px;height:48px;object-fit:contain;background:rgba(255,255,255,.12);border-radius:12px;padding:6px}
    .banner h3{margin:0;font-size:18px;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;}
    .banner p{margin:4px 0 0;font-size:14px;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.35);font-weight:800;
      text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;}
    .cta{margin-left:auto;padding:10px 14px;border-radius:12px;background:#fff;color:#000;font-weight:800;text-decoration:none}

    /* 로고 그리드 */
    .logos{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(min-width:600px){.logos{grid-template-columns:repeat(3,1fr)}}
    @media(min-width:900px){.logos{grid-template-columns:repeat(6,1fr)}}
    .logo{display:flex;flex-direction:column;align-items:center;gap:8px;background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px 10px;text-align:center;text-decoration:none;color:inherit;transition:transform .1s ease, box-shadow .1s ease}
    .logo:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.06)}
    .logo .img{width:56px;height:56px;border-radius:12px;border:1px solid var(--line);background:#f8fafc;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .logo img{width:100%;height:100%;object-fit:contain}

    /* Tip 박스 */
    .tip{background:#eff6ff;border:1px solid #bfdbfe;border-radius:12px;padding:14px 16px;color:#1e3a8a}

    /* 비교표 */
    .table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .table th,.table td{padding:10px 12px;border-bottom:1px solid var(--line);text-align:left}
    .table th{background:#f9fafb}
    .table tr:last-child td{border-bottom:0}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:700;font-size:12px;border:1px solid #c7d2fe}

    /* ====== Luxe Skin overrides ====== */
    .theme-luxe { font-family: "Pretendard", system-ui, -apple-system, Segoe UI, Roboto; letter-spacing: .1px; }
    .theme-luxe body { background: var(--bg); }
    .theme-luxe .wrap { position: relative; }
    .theme-luxe .wrap::after {
      content:""; position:absolute; inset:-40px;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence baseFrequency='0.65' numOctaves='2' stitchTiles='stitch' type='fractalNoise'/%3E%3CfeColorMatrix values='0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 .02 0'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)'/%3E%3C/svg%3E");
      pointer-events:none; opacity:.8;
    }
    .theme-luxe .card{
      backdrop-filter:saturate(140%) blur(8px);
      background:linear-gradient(#ffffffcc, #ffffffcc);
      border:1px solid rgba(0,0,0,.06);
      box-shadow:0 12px 28px rgba(2,8,20,.06), 0 2px 6px rgba(2,8,20,.06);
      border-radius:20px;
    }
    .theme-luxe .result-box{
      background:linear-gradient(180deg, rgba(248,250,252,.8), rgba(255,255,255,.85));
      border:1px solid rgba(2,8,20,.06);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
      border-radius:14px;
    }
    .theme-luxe .cta-main{
      background:linear-gradient(90deg, #0ea5e9, #6366f1);
      border:0; color:#fff; font-weight:900; letter-spacing:.2px;
      box-shadow:0 10px 22px rgba(14,165,233,.24), 0 4px 10px rgba(99,102,241,.16);
      position:relative; overflow:hidden; transition:transform .12s ease, box-shadow .2s ease;
    }
    .theme-luxe .cta-main::after{
      content:""; position:absolute; inset:-40% -10%;
      background:linear-gradient(120deg, transparent 20%, rgba(255,255,255,.38) 40%, transparent 60%);
      transform:translateX(-60%); filter:blur(8px); pointer-events:none;
      animation:ctaShine 3.5s infinite;
    }
    @keyframes ctaShine{ 0%{ transform:translateX(-60%) } 60%{ transform:translateX(120%) } 100%{ transform:translateX(120%) } }
    .theme-luxe .cta-main:hover{ transform:translateY(-1px); box-shadow:0 14px 28px rgba(14,165,233,.32), 0 6px 16px rgba(99,102,241,.22) }
    .theme-luxe .banner{ border-radius:22px; padding:18px 20px; box-shadow:0 10px 22px rgba(2,8,20,.06); position:relative; overflow:hidden; }
    .theme-luxe .banner::after{ content:""; position:absolute; inset:0; background:linear-gradient(180deg, rgba(255,255,255,.12), transparent 60%); pointer-events:none; }
    .theme-luxe .banner .badge{ background:rgba(255,255,255,.2); border-color:rgba(255,255,255,.45) }
    .theme-luxe .logo{ border-radius:18px; background:linear-gradient(#ffffff,#ffffff); border:1px solid rgba(2,8,20,.06); box-shadow:0 8px 18px rgba(2,8,20,.06); }
    .theme-luxe .logo:hover{ transform:translateY(-3px); box-shadow:0 14px 28px rgba(2,8,20,.10) }
    .theme-luxe .logo .img{ background:linear-gradient(#f8fafc,#ffffff) }
    .theme-luxe input, .theme-luxe select{ border-radius:14px; border:1px solid rgba(2,8,20,.08); background:#fff }
    .theme-luxe .seg button{ border-radius:14px; border:1px solid rgba(2,8,20,.08); background:#fff; font-weight:700 }
    .theme-luxe .seg button.active{ background:#111827; border-color:#111827; color:#fff; box-shadow:inset 0 1px 0 rgba(255,255,255,.18) }
    .theme-luxe .table{ border-radius:16px; border-color:rgba(2,8,20,.08); box-shadow:0 6px 14px rgba(2,8,20,.04) }
    .theme-luxe .table th{ background:#f3f4f6; font-weight:800 }
    .theme-luxe .tip{ background:linear-gradient(180deg,#eff6ff,#ffffff); border-color:#bfdbfe; border-radius:16px }
    .theme-luxe .trust{ border-radius:14px; background:linear-gradient(#fff7ed,#fff); border-color:#fde68a }

    /* 다크 모드 강제 토글 */
    body.is-dark { color-scheme: dark; }
    body.is-dark { --bg:#0b1220; --fg:#e2e8f0; --muted:#94a3b8; --line:rgba(255,255,255,.1); }
    body.is-dark .lead{ color:#94a3b8 }
    body.is-dark .card{ background:rgba(16,23,42,.75); border-color:rgba(255,255,255,.06) }
    body.is-dark .result-box{ background:rgba(17,24,39,.6); border-color:rgba(255,255,255,.06) }
    body.is-dark .table th{ background:#0f172a; color:#e2e8f0 }
    body.is-dark .table, body.is-dark .logo{ border-color:rgba(255,255,255,.06) }
    body.is-dark input, body.is-dark select{ background:#0f172a; color:#e2e8f0; border-color:rgba(255,255,255,.12) }
    body.is-dark .seg button{ background:#0f172a; color:#e2e8f0; border-color:rgba(255,255,255,.12) }
    body.is-dark .seg button.active{ background:#e2e8f0; color:#0b1220; border-color:#e2e8f0 }
    body.is-dark .tip{ background:linear-gradient(180deg,#0b1220,#0f172a); border-color:#1d4ed8; color:#c7d2fe }
    body.is-dark .trust{ background:linear-gradient(180deg,#0b1220,#0f172a); color:#fde68a; border-color:#f59e0b }

    /* ── Ripple 효과 (빗방울) ───────────────────────── */
    .ripple-host { position: relative; overflow: hidden; }
    .ripple {
      position: absolute; left: 0; top: 0; width: 20px; height: 20px;
      transform: translate(-50%,-50%) scale(0);
      border-radius: 50%;
      pointer-events: none;
      background: radial-gradient(circle,
        rgba(255,255,255,0.65) 0%,
        rgba(255,255,255,0.45) 30%,
        rgba(255,255,255,0.22) 55%,
        rgba(255,255,255,0.00) 70%);
      mix-blend-mode: screen;
      filter: blur(0.3px);
      animation: rippleExpand 720ms cubic-bezier(.2,.7,.2,1) forwards;
    }
    @keyframes rippleExpand {
      to { transform: translate(-50%,-50%) scale(18); opacity: 0; }
    }
    body.is-dark .ripple{
      background: radial-gradient(circle,
        rgba(255,255,255,0.85) 0%,
        rgba(255,255,255,0.55) 30%,
        rgba(255,255,255,0.30) 55%,
        rgba(255,255,255,0.00) 70%);
    }
  </style>
</head>

<body class="theme-luxe">
<div class="wrap">
  <div class="topbar">
    <h1 style="margin-right:8px">코인 수수료 계산기</h1>
    <div class="spacer"></div>
    <button id="themeBtn" class="theme-toggle" aria-label="테마 전환">
      <svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4a1 1 0 0 1 1-1h0a1 1 0 1 1-2 0h0a1 1 0 0 1 1 1Zm0 17a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm9-9a1 1 0 1 1 0 2 1 1 0 0 1 0-2ZM4 12a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm13.66 6.66a1 1 0 0 1 1.41 1.41 1 1 0 0 1-1.41-1.41ZM4.93 5.64A1 1 0 0 1 3.5 4.22a1 1 0 1 1 1.41 1.42Zm14.14-1.42a1 1 0 0 1-1.41 1.42 1 1 0 1 1 1.41-1.42ZM5.64 19.07a1 1 0 1 1-1.41 1.41 1 1 0 0 1 1.41-1.41ZM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10Z"/></svg>
      <span id="themeLabel">라이트</span>
    </button>
  </div>
  <p class="lead">
    거래소 수수료와 페이백을 계산해 보세요. <b style="color:#ef4444">※ 예시 수수료율은 참고용이며, 실제 적용은 각 거래소 공식 페이지/VIP 등급/토큰 할인 조건을 확인하세요.</b>
  </p>

  <!-- 계산기 + 결과 -->
  <div class="grid" id="calc-grid">
    <div class="card">
      <h3 class="section-title">기본 설정</h3>
      <div class="row">
        <div>
          <label>거래소</label>
          <select id="exchange"></select>
        </div>
        <div>
          <label>마켓</label>
          <div class="seg">
            <button id="btn-spot">스팟</button>
            <button id="btn-perp" class="active">선물(퍼프)</button>
          </div>
        </div>
        <div>
          <label>주문 유형</label>
          <div class="seg">
            <button id="btn-maker">지정가(Maker)</button>
            <button id="btn-taker" class="active">시장가(Taker)</button>
          </div>
        </div>
      </div>
      <div id="preset-note" style="font-size:12px;color:#6b7280;margin-top:6px"></div>

      <div class="row" style="margin-top:8px">
        <div>
          <label>체결가치 (USDT)</label>
          <input id="notional" type="number" min="0" value="10000"/>
        </div>
        <div>
          <label class="hint">커스텀 수수료율 (%) 
            <span class="t" title="VIP/프로모션으로 본인 수수료가 다를 때 입력하면 프리셋 대신 이 값으로 계산돼요.">ⓘ</span>
          </label>
          <input id="customFee" type="number" step="0.0001" min="0" placeholder="프리셋 사용"/>
        </div>
        <div>
          <label class="hint">거래 횟수 (합산) 
            <span class="t" title="동일 조건으로 여러 번 거래할 경우 총 수수료를 합산해 계산합니다.">ⓘ</span>
          </label>
          <input id="trades" type="number" min="1" value="1"/>
        </div>
        <div>
          <label class="hint">사용자 페이백 (%) 
            <span class="t" title="레퍼럴/이벤트로 돌려받는 비율을 입력하세요. 미입력 시 0%로 계산됩니다.">ⓘ</span>
          </label>
          <input id="payback" type="number" step="0.1" min="0" max="100" value="20"/>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="section-title">결과</h3>
      <div class="result-box">
        <div class="kv"><div class="k">사용 수수료율</div><div class="v" id="v-rate">-</div></div>
        <div class="kv"><div class="k">총 수수료 (1회)</div><div class="v" id="v-fee1">-</div></div>
        <div class="kv"><div class="k">총 수수료 (합산)</div><div class="v" id="v-feeN">-</div></div>
        <div class="hr"></div>
        <div class="kv"><div class="k">사용자 페이백</div><div class="v" id="v-payback">-</div></div>
        <div class="kv"><div class="k">사용자 실부담 수수료</div><div class="v" id="v-net">-</div></div>
        <div class="kv"><div class="k">체감 수수료율(평균)</div><div class="v" id="v-eff">-</div></div>
      </div>

      <!-- 혜택 중심 CTA -->
      <a id="cta" class="cta-main" href="#" target="_blank" rel="noopener">혜택 적용 후 이동</a>

      <!-- 신뢰성/안내 -->
      <div class="trust">
        <b>안내</b> · 본 계산기는 참고용이며, 실제 혜택은 각 거래소의 정책/VIP 등급 및 토큰 할인에 따라 달라질 수 있습니다.
        일부 거래소는 제 파트너(공식 파트너/레퍼럴) 전용 혜택 기준이 적용됩니다. 상세 조건은 링크 이동 후 꼭 확인해 주세요.
      </div>
    </div>
  </div>

  <!-- ▼ 거래소 배너 + 로고 ▼ -->
  <div id="exchanges">
    <div id="banners"></div>

    <div style="margin-top:18px" class="card">
      <h3 class="section-title">거래소 바로가기</h3>
      <div class="logos" id="logos"></div>
    </div>
  </div>

  <!-- Tip -->
  <div style="margin-top:18px" class="tip">
    💡 <b>초보자 팁</b> · 처음엔 수수료가 낮고 UI가 쉬운 거래소부터 시작하세요. 선물(퍼프) 거래는 리스크가 크니 반드시 <b>소액</b>으로 연습 후 진입하세요.
    자세한 가이드는 <a href="https://cafe.naver.com/bitupg?iframe_url_utf8=%2FArticleRead.nhn%253Fclubid%3D31418638%2526articleid%3D82%2526menuid%3D2%2526boardtype%3DL" target="_blank" rel="noopener">네이버 카페</a> 참고.
  </div>

  <!-- 비교/설명 섹션 -->
  <div style="margin-top:18px" class="card">
    <h3 class="section-title">거래소 수수료 비교 · 핵심 요약</h3>
    <p style="color:var(--muted);margin:6px 0 12px">아래는 예시 기준(혜택 적용 후) 요약입니다. 실제 적용은 등급/이벤트에 따라 다를 수 있습니다.</p>
    <div style="overflow:auto">
      <table class="table">
        <thead>
          <tr><th>거래소</th><th>지정가</th><th>시장가</th><th>페이백</th><th>특징</th></tr>
        </thead>
        <tbody id="cmp-body"></tbody>
      </table>
    </div>

    <h4 style="margin:16px 0 8px">자주 묻는 질문(FAQ)</h4>
    <ul style="margin:0;padding-left:18px;line-height:1.6">
      <li><b>Q. 커스텀 수수료율은 언제 쓰나요?</b><br>→ 거래소에서 개인 VIP/프로모션 등으로 수수료가 다를 때 직접 입력하세요.</li>
      <li><b>Q. 페이백은 어디서 확인하나요?</b><br>→ 거래소 이벤트/레퍼럴 정책에 따라 변동됩니다. 버튼을 눌러 상세 페이지에서 확인하세요.</li>
      <li><b>Q. 계산 결과가 실제와 달라요.</b><br>→ 체결 방식/포인트 할인/코인 보유 할인 등이 반영되지 않았을 수 있어요. 안내 문구의 유의사항을 참고하세요.</li>
    </ul>
  </div>
</div>

<!-- ===== 데이터 & 로직 ===== -->
<script>
/* 거래소 데이터 (혜택 중심 CTA 포함) */
const PROMOS = [
  {
    name:'Bitget',
    logo:'https://logo.clearbit.com/bitget.com',
    grad:['#22d3ee','#2563eb'],
    before:{maker:0.04,taker:0.06},
    after:{maker:0.016,taker:0.032},
    payback:'20%',
    note:'수수료 할인 + 페이백 20%',
    link:'https://partner.bitget.com/bg/Jihoon7',
    cta:'🎁 지금 가입하고 수수료 50%↓ + 페이백 20% 받기'
  },
  {
    name:'Bybit',
    logo:'https://logo.clearbit.com/bybit.com',
    grad:['#f59e0b','#d97706'],
    before:{maker:0.02,taker:0.055},
    after:{maker:0.02,taker:0.055},
    payback:'20%',
    note:'페이백 20% 적용',
    link:'https://partner.bybit.com/b/JIHOON',
    cta:'🚀 Bybit 신규 혜택 받고 거래 시작'
  },
  {
    name:'OKX',
    logo:'https://logo.clearbit.com/okx.com',
    grad:['#111111','#000000'],
    before:{maker:0.02,taker:0.05},
    after:{maker:0.02,taker:0.045},
    payback:'20%',
    note:'페이백 20% 적용',
    link:'https://www.okx.com/join/KANGJIHOON',
    cta:'✅ OKX 혜택 적용 후 바로 이동'
  },
  {
    name:'MEXC',
    logo:'https://logo.clearbit.com/mexc.com',
    grad:['#10b981','#059669'],
    before:{maker:0.0,taker:0.02},
    after:{maker:0.0,taker:0.018},
    payback:'20%',
    note:'페이백 20% 적용',
    link:'https://www.mexc.com/ko-KR/acquisition/custom-sign-up?shareCode=mexc-Jihoon',
    cta:'🎯 MEXC 0% / 0.018% 혜택 받고 시작'
  },
  {
    name:'Binance',
    logo:'https://logo.clearbit.com/binance.com',
    grad:['#f59e0b','#f59e0b'],
    before:{maker:0.02,taker:0.04},
    after:{maker:0.018,taker:0.038},
    payback:'—',
    note:'수수료 할인 10%',
    link:'https://accounts.binance.com/register?ref=ME5CYRHB',
    cta:'💡 Binance 수수료 할인 적용 후 이동'
  },
  {
    name:'BingX',
    logo:'https://logo.clearbit.com/bingx.com',
    grad:['#0ea5e9','#1d4ed8'],
    before:{maker:0.02,taker:0.05},
    after:{maker:0.011,taker:0.0275},
    payback:'42~45%',
    note:'페이백 42~45% (변동)',
    link:'https://bingx.com/invite/2N30XH/',
    cta:'🔥 BingX 최대 45% 페이백 받고 시작'
  },
];

/* 계산 프리셋 */
const PRESETS = {};
PROMOS.forEach(p=>{
  const eff = p.after;
  PRESETS[p.name] = {
    spot: { maker: p.name==='MEXC'?0:0.001, taker: p.name==='MEXC'?0.00018:0.001, note: p.name==='MEXC'?'스팟 적용 후: 지정가 0.0% / 시장가 0.018%':'스팟 예시(간단화)' },
    perp: { maker: eff.maker/100, taker: eff.taker/100, note: `적용 후: 지정가 ${p.after.maker}% / 시장가 ${p.after.taker}%` }
  };
});

/* 엘리먼트 */
const elExchange=document.getElementById('exchange');
const elSpot=document.getElementById('btn-spot');
const elPerp=document.getElementById('btn-perp');
const elMaker=document.getElementById('btn-maker');
const elTaker=document.getElementById('btn-taker');
const elNotional=document.getElementById('notional');
const elCustom=document.getElementById('customFee');
const elTrades=document.getElementById('trades');
const elPayback=document.getElementById('payback');
const elNote=document.getElementById('preset-note');
const vRate=document.getElementById('v-rate');
const vFee1=document.getElementById('v-fee1');
const vFeeN=document.getElementById('v-feeN');
const vPB=document.getElementById('v-payback');
const vNet=document.getElementById('v-net');
const vEff=document.getElementById('v-eff');
const elCTA=document.getElementById('cta');
const themeBtn=document.getElementById('themeBtn');
const themeLabel=document.getElementById('themeLabel');

let state={exchange:'Bitget',market:'perp',order:'taker'};

/* 유틸 */
const toggle=(on,off)=>{on.classList.add('active');off.classList.remove('active');};
const toPerc=x=>(x*100).toFixed(6).replace(/0+$/,'').replace(/\.$/,'')+'%';
const nf=x=>(Math.round(x*1e8)/1e8).toLocaleString();

/* 숫자 카운트업 애니메이션 */
function animateNumber(el, target, fmt=(x)=>x, duration=450){
  const startVal = el.dataset.v ? parseFloat(el.dataset.v) : 0;
  const start = performance.now();
  const diff = target - startVal;
  function step(t){
    const p = Math.min(1, (t-start)/duration);
    const val = startVal + diff*p;
    el.textContent = fmt(val);
    el.dataset.v = val;
    if(p<1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* ===== Ripple 유틸 ===== */
function spawnRipple(host, x, y) {
  if (!host.classList.contains('ripple-host')) host.classList.add('ripple-host');
  const r = document.createElement('span');
  r.className = 'ripple';
  r.style.left = x + 'px';
  r.style.top  = y + 'px';
  host.appendChild(r);
  r.addEventListener('animationend', () => r.remove());
}

/* 결과 업데이트 */
function update(){
  const ex=state.exchange, market=state.market, order=state.order;
  const preset=PRESETS[ex][market][order];
  const custom=parseFloat(elCustom.value||'');
  const rate=isNaN(custom)?preset:custom/100;

  const N=Math.max(0,parseFloat(elNotional.value||'0'));
  const t=Math.max(1,parseInt(elTrades.value||'1',10));
  const fee1=N*rate, feeN=fee1*t;
  const pbRate=Math.max(0,Math.min(1,(parseFloat(elPayback.value)||0)/100));
  const pb=feeN*pbRate, net=feeN-pb, eff=N>0?net/(N*t):0;

  elNote.textContent=`프리셋: ${ex} / ${market==='spot'?'스팟':'선물'} / ${order.toUpperCase()} = ${toPerc(preset)} · ${PRESETS[ex][market].note}`;

  animateNumber(vRate, rate, (x)=>toPerc(x));
  animateNumber(vFee1, fee1, (x)=>nf(x)+' USDT');
  animateNumber(vFeeN, feeN, (x)=>nf(x)+' USDT');
  animateNumber(vPB, pb, (x)=>nf(x)+' USDT');
  animateNumber(vNet, net, (x)=>nf(x)+' USDT');
  animateNumber(vEff, eff, (x)=>toPerc(x));

  // CTA 스타일/문구
  const promo=PROMOS.find(p=>p.name===ex);
  elCTA.href=promo.link;
  elCTA.style.background=`linear-gradient(90deg, ${promo.grad[0]}, ${promo.grad[1]})`;
  elCTA.textContent=promo.cta;
}

/* 초기 렌더링 */
(function init(){
  // 거래소 드롭다운
  PROMOS.forEach(p=>{
    const o=document.createElement('option');o.value=p.name;o.textContent=p.name;elExchange.appendChild(o);
  });
  elExchange.value=state.exchange;

  // 배너 컨테이너
  const banners=document.getElementById('banners');

  // 배너 (✅ 카드별 패럴랙스 + 호버시 빗방울)
  PROMOS.forEach(p=>{
    const b=document.createElement('div');
    b.className='banner';
    b.style.background=`linear-gradient(90deg,${p.grad[0]},${p.grad[1]})`;
    b.dataset.depth = 6;
    b.innerHTML=`
      <img src="${p.logo}" alt="${p.name}">
      <div style="flex:1">
        <h3>${p.name} 수수료 안내</h3>
        <p>
          <span class="badge">적용 전: 지정가 <b>${p.before.maker}%</b> / 시장가 <b>${p.before.taker}%</b></span>
          <span class="badge">적용 후: 지정가 <b>${p.after.maker}%</b> / 시장가 <b>${p.after.taker}%</b></span>
          <span class="badge">${p.note}</span>
        </p>
      </div>`;
    const a=document.createElement('a');
    a.className='cta';a.textContent=p.cta;a.href=p.link;a.target='_blank';a.rel='noopener';
    b.appendChild(a);
    banners.appendChild(b);

    // 패럴랙스: 해당 카드만 미세 이동
    b.addEventListener('mousemove',(e)=>{
      const r=b.getBoundingClientRect();
      const x=(e.clientX-r.left)/r.width - 0.5;
      const y=(e.clientY-r.top)/r.height - 0.5;
      const d=parseFloat(b.dataset.depth||6);
      b.style.transform=`translate3d(${x*d}px, ${y*d}px, 0)`;
    });
    b.addEventListener('mouseleave',()=>{
      b.style.transform='translate3d(0,0,0)';
    });

    // 호버 시작 지점에서 '빗방울' 퍼짐
    b.addEventListener('mouseenter',(e)=>{
      const rect = b.getBoundingClientRect();
      spawnRipple(b, e.clientX - rect.left, e.clientY - rect.top);
    });
  });

  // 로고
  const logos=document.getElementById('logos');
  PROMOS.forEach(p=>{
    const a=document.createElement('a');a.className='logo';a.href=p.link;a.target='_blank';a.rel='noopener';
    a.innerHTML=`<div class="img"><img src="${p.logo}"
      onerror="this.style.display='none';this.parentElement.innerHTML='<span style=\\'font-weight:700;font-size:13px\\'>${p.name}</span>';"></div>
      <div style="font-weight:800">${p.name}</div>
      <div style="font-size:12px;color:#2563eb">혜택 페이지 이동</div>`;
    logos.appendChild(a);
  });

  // 비교표
  const body=document.getElementById('cmp-body');
  PROMOS.forEach(p=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td style="font-weight:800">${p.name}</td>
      <td>${p.after.maker}%</td>
      <td>${p.after.taker}%</td>
      <td><span class="pill">${p.payback}</span></td>
      <td>${p.note}</td>`;
    body.appendChild(tr);
  });

  // 이벤트 바인딩
  elExchange.addEventListener('change',()=>{state.exchange=elExchange.value;update()});
  elSpot.addEventListener('click',()=>{state.market='spot';toggle(elSpot,elPerp);update()});
  elPerp.addEventListener('click',()=>{state.market='perp';toggle(elPerp,elSpot);update()});
  elMaker.addEventListener('click',()=>{state.order='maker';toggle(elMaker,elTaker);update()});
  elTaker.addEventListener('click',()=>{state.order='taker';toggle(elTaker,elMaker);update()});
  [elNotional,elCustom,elTrades,elPayback].forEach(el=>el.addEventListener('input',update));

  // 테마 초기화(로컬 저장)
  const saved=localStorage.getItem('calc-theme');
  if(saved==='dark') document.body.classList.add('is-dark');
  themeLabel.textContent = document.body.classList.contains('is-dark') ? '다크' : '라이트';

  update();

  // CTA 버튼: 클릭 시 물방울 파동
  if (elCTA) {
    elCTA.classList.add('ripple-host');
    elCTA.addEventListener('click', (e)=>{
      const rect = elCTA.getBoundingClientRect();
      spawnRipple(elCTA, e.clientX - rect.left, e.clientY - rect.top);
    });
  }
})();

/* 테마 토글 */
themeBtn.addEventListener('click',()=>{
  document.body.classList.toggle('is-dark');
  const dark=document.body.classList.contains('is-dark');
  themeLabel.textContent=dark?'다크':'라이트';
  localStorage.setItem('calc-theme', dark?'dark':'light');
});
</script>

<!-- FAQ 구조화 데이터 (SEO) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [{
    "@type": "Question",
    "name": "커스텀 수수료율은 언제 쓰나요?",
    "acceptedAnswer": { "@type": "Answer", "text": "거래소에서 개인 VIP/프로모션 등으로 수수료가 다를 때 직접 입력해 계산합니다." }
  }, {
    "@type": "Question",
    "name": "페이백은 어디서 확인하나요?",
    "acceptedAnswer": { "@type": "Answer", "text": "거래소 이벤트/레퍼럴 정책에 따라 변동됩니다. 각 거래소 버튼을 눌러 상세 페이지에서 확인하세요." }
  }, {
    "@type": "Question",
    "name": "계산 결과가 실제와 다른 이유는?",
    "acceptedAnswer": { "@type": "Answer", "text": "체결 방식, 포인트/토큰 할인, VIP 등급, 이벤트 등이 반영되지 않았을 수 있습니다. 안내 문구의 유의사항을 참고하세요." }
  }]
}
</script>
</body>
</html>
